// Simple heuristic parser to extract complaints, solutions, and status.\n// Customize keyword sets as needed.\n\nconst complaintKeywords = [\n  'slow internet', 'no internet', 'disconnect', 'packet loss', 'latency', 'speed', 'downtime', 'buffering', 'not working', 'service issue', 'complaint'\n]\nconst solutionKeywords = [\n  'restarted', 'reset', 'replaced', 'engineer', 'technician', 'scheduled', 'ticket', 'refund', 'credited', 'resolved', 'fixed', 'investigating', 'monitoring', 'escalated'\n]\nconst resolvedIndicators = ['resolved','fixed','closed','issue solved','working now']\nconst unresolvedIndicators = ['pending','ongoing','still','not resolved','escalated','awaiting','investigating']\n\nexport function parseEmailToRecord({ subject = '', body = '', from = '' }) {\n  const text = `${subject}\\n${body}`.toLowerCase()\n\n  const problem = complaintKeywords.find(k => text.includes(k)) || extractProblem(text)\n  const solution = extractSolution(text)\n  const status = inferStatus(text)\n  const clientName = parseClientName(from)\n\n  return {\n    clientName,\n    problem,\n    solution,\n    status,\n  }\n}\n\nfunction parseClientName(from) {\n  // from: \"Name <email@domain>\"\n  const m = /\\\"?([^\"<]+)\\\"?\\s*<[^>]+>/.exec(from) || /([^@]+)@/.exec(from)\n  return m ? m[1].trim() : ''\n}\n\nfunction extractProblem(text) {\n  // Fallback: first sentence mentioning typical issue words\n  const m = /(internet|wifi|broadband|connection|speed|latency|disconnect|packet)/i.exec(text)\n  if (!m) return ''\n  const idx = Math.max(0, text.lastIndexOf('\\n', m.index))\n  const end = text.indexOf('.', m.index+1)\n  return text.slice(idx, end>0?end: m.index+120).trim()\n}\n\nfunction extractSolution(text) {\n  // Look for solution-like keywords and capture surrounding text\n  for (const k of solutionKeywords) {\n    const i = text.indexOf(k)\n    if (i !== -1) {\n      const end = text.indexOf('.', i)\n      const start = Math.max(0, text.lastIndexOf('\\n', i))\n      return text.slice(start, end>0?end:i+120).trim()\n    }\n  }\n  return ''\n}\n\nfunction inferStatus(text) {\n  if (resolvedIndicators.some(k=>text.includes(k))) return 'Resolved'\n  if (unresolvedIndicators.some(k=>text.includes(k))) return 'Unresolved'\n  return 'Unknown'\n}\n